<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
		<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
		<title></title>
		<link rel="stylesheet" type="text/css" href="../css/Hui.css" />
		<link rel="stylesheet" type="text/css" href="../css/mui.min.css" />
		<style type="text/css">
			.mui-bar {
				-webkit-box-shadow: 1px 0px 3px rgba(0,0,0,0.7);
				box-shadow: 1px 0px 3px rgba(0,0,0,0.7);
			}
			.H-display-block a {
				color: #ccc
			}
			.mui-table-view-cell a {
				color: #333
			}
		</style>
		<script id="msglistTpl" type="text/x-dot-template">
			{{~it:value:index}}
			<div class="list" style="padding-top: 10px"  data-id="{{=value.id}}" tapmode onclick="openxiangqing('{{=value.id}}');">
			<div class="bbs-item H-border-vertical-bottom-after">
			<div class="H-flexbox-horizontal H-theme-background-color-white" style="padding-top:5px">
			<div class="H-padding-vertical-both-8" data-id="{{=value.id}}"  data-name="{{=value.username}}" data-img="{{=value.userimg}}" tapmode onclick="event.stopPropagation();opengerenzhuye(this);">
			<img src="../image/zhanweitupian.jpg" alt=""  {{? value.userimg}} data-echo="{{=value.userimg}}"{{? }} class=" H-display-block H-margin-horizontal-left-10 H-border-radius-circle H-width-45 H-height-45" />
			</div>
			<div class="H-flex-item H-margin-10">
			<div class="H-theme-font-color-999 H-font-size-14 H-flexbox-horizontal H-text-horizontal-left H-box-sizing-border-box">
			<span class="H-display-block H-flex-item H-text-align-left H-font-size-16" style="color: #333">{{=value.username}}</span>
			<span class="H-display-block H-flex-item H-text-align-right  H-font-size-12 mui-icon mui-icon-arrowdown" style="color:#ccc" tapmode onclick="event.stopPropagation();scene();"></a></span>
			</div>
			<div class="H-theme-font-color-999 H-text-show-row-1 H-font-size-12">
			{{=_formatDate(value.updatedAt)}}
			</div>
			</div>
			</div>
			<div class="H-theme-background-color-white H-theme-font-color-333  H-font-size-16" style="padding: 2px 10px 10px 10px" onclick="">
			{{=value.neirong}}
			</div>
			{{  if(value.tupian) { }}
			<div id="{{=value.id}}" class="H-theme-background-color-white H-clear-both H-width-100-percent H-display-table H-box-sizing-border-box H-padding-horizontal-left-10 H-padding-horizontal-right-5" onclick="">
			{{ for(var k in value.tupian) { }}
			<li class="H-display-table-cell H-float-left  H-box-sizing-border-box H-width-avg-3 H-padding-horizontal-right-5 H-margin-vertical-bottom-5" data-key="{{=k}}" tapmode onclick="event.stopPropagation();imageBrowsertupian(this)">
			<img  src="../image/zhanweitupian.jpg"  class="H-width-100-percent  H-display-block tupaingaodu" data-tupianurl="{{=value.tupian[k]}}" alt=""  data-echo="{{=value.tupian[k]+"?imageView2/1/w/200/h/200/q/100"}}"/>
			</li>
			{{ }  }}
			</div>
			{{ }  }}
			<div class="H-flexbox-horizontal H-clear-both H-theme-background-color-white H-padding-8 H-box-sizing-border-box H-border-vertical-top-margin-both-10-after">
			<span class="H-font-size-14 H-flex-item  H-center-all H-border-horizontal-right-after"><i class="mui-icon mui-icon-eye  H-theme-font-color-ccc H-font-size-18 H-margin-horizontal-right-5"></i><label class="H-display-inline-block H-vertical-middle">3</label></span>
			<span class="H-font-size-14 H-flex-item  H-center-all"><i class="mui-icon mui-icon-chatbubble H-theme-font-color-ccc H-font-size-18 H-margin-horizontal-right-5"></i><label class="H-display-inline-block H-theme-font-color-ccc H-vertical-middle">3</label></span>
			<span class="H-font-size-14 H-flex-item  H-center-all  H-border-horizontal-left-after"><i class="mui-icon mui-icon-star H-theme-font-color-ccc H-font-size-18 H-margin-horizontal-right-5"></i><label class="H-display-inline-block H-theme-font-color-ccc H-vertical-middle">3</label></span>
			</div>
			</div>
			</div>
			{{~}}
		</script>
	</head>
	<body>
		<header class="mui-bar mui-bar-nav" id="aui-header" style="height: 1px;"></header>
		<div class="mui-content" style="padding-top: 0px;margin-top: 0" id="msglist">
<!--			<div class="list">
				<div class="bbs-item H-border-vertical-bottom-after" tapmode onclick="">
					<div class="H-flexbox-horizontal H-theme-background-color-white" style="padding-top: 6px">
						<div class="H-padding-vertical-both-8">
							<img src="../image/ad1.png" alt="" title="" class=" H-display-block H-margin-horizontal-left-10 H-border-radius-circle H-width-45 H-height-45" />
						</div>
						<div class="H-flex-item H-margin-10">
							<div class="H-theme-font-color-999 H-font-size-14 H-flexbox-horizontal H-text-horizontal-left H-box-sizing-border-box">
								<span class="H-display-block H-flex-item H-text-align-left H-font-size-16" style="color: #333">新生帝</span>
								<span class="H-display-block H-flex-item H-text-align-right mui-icon mui-icon-arrowdown" style="color: #ccc"></span>
							</div>
							<div class="H-theme-font-color-999 H-text-show-row-1  H-font-size-12">
								广东省中山市中山二路48好怡中大厦5楼515
							</div>
						</div>
					</div>
					<div class="H-theme-background-color-white H-theme-font-color-333  H-font-size-14" style="padding: 2px 3.333333333% 10px 3.333333333%" onclick="OpenBbs(1);">
						一切从简，只为了更懒！Hui是新生帝个人开发，版权所有为中山赢友网络科技有限公司！
					</div>
					<div class="tupain  H-theme-background-color-white H-clear-both H-width-100-percent H-display-table H-box-sizing-border-box H-padding-horizontal-left-10 H-padding-horizontal-right-5" onclick="OpenBbs(1);">
						<li class="H-display-table-cell H-float-left  H-box-sizing-border-box H-width-avg-1 H-padding-horizontal-right-5 H-margin-vertical-bottom-5"   tapmode onclick="">
							<img src="../image/ceshit1.png" class="H-width-100-percent  H-display-block" alt="" style="height:'+tupiangaodu+'px" />
						</li>
						<li class="H-display-table-cell H-float-left  H-box-sizing-border-box H-width-avg-1 H-padding-horizontal-right-5 H-margin-vertical-bottom-5" style="height:30%" tapmode onclick="">
							<img src="../image/ceshit1.png" class="H-width-100-percent  H-display-block" alt=""/>
						</li>
						<li class="H-display-table-cell H-float-left  H-box-sizing-border-box H-width-avg-1 H-padding-horizontal-right-5 H-margin-vertical-bottom-5" s tapmode onclick="">
							<img src="../image/ceshit1.png" class="H-width-100-percent  H-display-block" alt=""  />
						</li>
					</div>
					<div class="H-flexbox-horizontal H-clear-both H-theme-background-color-white H-padding-8 H-box-sizing-border-box H-border-vertical-top-margin-both-10-after">
						<span class="H-font-size-14 H-flex-item  H-center-all H-border-horizontal-right-after"><i class="mui-icon mui-icon-eye  H-theme-font-color-ccc H-font-size-18 H-margin-horizontal-right-5"></i><label class="H-display-inline-block H-vertical-middle">3</label></span>
						<span class="H-font-size-14 H-flex-item  H-center-all"><i class="mui-icon mui-icon-chatbubble H-theme-font-color-ccc H-font-size-18 H-margin-horizontal-right-5"></i><label class="H-display-inline-block H-theme-font-color-ccc H-vertical-middle">3</label></span>
						<span class="H-font-size-14 H-flex-item  H-center-all  H-border-horizontal-left-after"><i class="H-iconfont H-icon-ding-null H-theme-font-color-ccc H-font-size-18 H-margin-horizontal-right-5"></i><label class="H-display-inline-block H-theme-font-color-ccc H-vertical-middle">3</label></span>
					</div>
				</div>
			</div>-->
		</div>
		</body>
		<div class="H-padding-vertical-bottom-10"></div>
		<script type="text/javascript" src="../script/winu-base.js"></script>
		<script type="text/javascript" src="../script/mui.min.js"></script>
		<script type="text/javascript" src="../script/echo.js"></script>
		<script type="text/javascript" src="../script/api.js"></script>
		<script type="text/javascript" src="../script/SHA1.js"></script>
		<script type="text/javascript" src="../script/doT.min.js"></script>
		<script type="text/javascript" src="../script/zepto.min.js"></script>
		<script type="text/javascript">
			var imageBrowser;
			var shoujikuandu;
			var shoujigaodu;
			var tupiangaodu
			var browerImgs = [];
			var skip = 0;
		    var limit = 5;
			//				Zepto(function($) {
			//					// 绑定会话点击事件
			//					$("#msglist").on("click", "li img", function() {
			////						alert(typeof($(this).parent("div").attr("data-tupian").split(",")));
			//						alert(typeof(JSON.stringify("[\""+$(name).parent("div").attr("data-tupian").replace(/,http/g,"\",\"http")+"\"]")));
			//						//获取用户表自增ID
			////						imageBrowser($(this).attr("data-key"), $(this).attr("data-tupian"));
			//					});
			//				});
			function imageBrowsertupian(name) {
				var browerImgs = [];
				$(name).parent("div").children("li").each(function() {
					// 将图片追加到数组中
					browerImgs.push($(this).find("img").attr("data-tupianurl"));
				});
				//					alert( typeof (browerImgs));
				//				alert("[\""+$(name).parent("div").attr("data-tupian").replace(/,http/g,"\",\"http")+"\"]");
				imageBrowser.openImages({
					imageUrls : browerImgs,
					showList : false,
					activeIndex : $(name).attr("data-key")
				});
			}

			//			function ceshi() {
			//				mui('.mui-popover').popover('hide');
			//			}
			function openxiangqing(id) {
				api.openWin({
					pageParam : {
					value: id,
					},
					name : 'xiangqing-win',
					url : '../html/xiangqing-win.html'
				});
			}

			function opengerenzhuye(user) {
				api.openWin({
					pageParam : {
						id : $(user).attr("data-id"),
						name : $(user).attr("data-name"),
						img : $(user).attr("data-img"),
					},
					name : 'zhuyewin',
					url : '../html/zhuyewin.html'
				});
			}

			function scene() {
				var dialogBox = api.require('dialogBox');
				dialogBox.scene({
					rect : {
						w : 280,
						h : 320
					},
					
					styles : {
						bg : '#fff',
						corner:4,            
						title : {
							bg : '#fff',
							h : 1,
							size : 1,
							color : '#000'
						},
						cell : {
							bg : '#fff',
							h : 48,
							text : {
								color : '#333',
								size : 17
							},
						},
					},
					optionDatas : [{
						text : '收藏'
					}, {
						text : '关注TA'
					}, {
						text : '关注该分类'
					}, {
						text : '屏蔽TA'
					}, {
						text : '屏蔽该分类'
					}, {
						text : '举报'
					}],
					 tapClose: true
				}, function(ret, err) {
					if (ret) {
						alert(JSON.stringify(ret));
						var dialogBox = api.require('dialogBox');
						dialogBox.close({
							dialogName : 'scene'
						});
					} else {
						alert(JSON.stringify(err));
						var dialogBox = api.require('dialogBox');
						dialogBox.close({
							dialogName : 'scene'
						});
					}
				});
			}

			//				function OpenBbs(id) {
			//					H.openWin('info_head', 'info_head.html', {
			//						'id' : id
			//					});
			//				}

			apiready = function() {
							
				shoujikuandu = api.winWidth;
				shoujigaodu = api.winHeight;
				tupiangaodu = (api.winWidth - 20) / 3;
				//				$("li  img").css("height",tupiangaodu);
				imageBrowser = api.require('imageBrowser');
				//
				//				tupiangaodu=(api.winWidth-20)/3;
				//				alert(tupiangaodu);
				//				$api.css($api.byId("tupian"),"height:130px");
				//				$("#tupian").css("height",tupiangaodu);
				getdate();
				api.setRefreshHeaderInfo({
					visible : true,
					loadingImg : 'widget://image/refresh.png',
					bgColor : '#efeff4',
					textColor : '#333',
					textDown : '下拉刷新...',
					textUp : '松开刷新...',
					showTime : true
				}, function(ret, err) {
					//				setTimeout(function() {
					getdate();
//					setTimeout(api.refreshHeaderLoadDone(), 2000);
					api.refreshHeaderLoadDone();
					//				}, 3000);
				});
				 api.addEventListener({
                name: 'scrolltobottom'
                }, function (ret, err) {
             				var bodyParam = {
//					'fields' : {
//						'username' : true,
//						'id' : true,
//						'userimg' : true,
//						'imToken' : true,
//					},
					order : 'createdAt DESC',
					skip:skip,
					limit:limit
					
				};
				$api.ajax('/fabu?filter=' + JSON.stringify(bodyParam), 'get', null, function(ret, err) {
					if (ret) {
						//							alert(JSON.stringify(ret[0]));
						//							alert(JSON.stringify(ret[0].tupian));
						var interText = doT.template($("#msglistTpl").text());
						$("#msglist").append(interText(ret));
						echo.init({
							offset : 100,
							throttle : 250,
							callback : function(element, op) {
							}
						});
						api.parseTapmode();
						skip=skip+5;
						if(ret.length>0){
						api.toast({
								msg : '有'+ret.length+'条最新内容',
								duration : 1000,
								location : 'top'
							});
							}else{
							
							api.toast({
								msg : '没有最新消息了，稍后再刷新试试吧',
								duration : 1000,
								location : 'top'
							});
							}
					}
				})
                });   
                     	_addEventListener("sendfabusuccessed", function(ret) {
			
				if (ret && ret.value.id) {
							var bodyParam = {
//					'fields' : {
//						'username' : true,
//						'id' : true,
//						'userimg' : true,
//						'imToken' : true,
//					},
					order : 'createdAt DESC',
					skip:0,
					limit:1,
					where : {
					"userid" : ret.value.id
				}
					
				};
				$api.ajax('/fabu?filter=' + JSON.stringify(bodyParam), 'get', null, function(ret, err) {
					if (ret) {
//											alert(JSON.stringify(ret[0]));
//												alert(JSON.stringify(ret[0].tupian));
						var interText = doT.template($("#msglistTpl").text());
						$("#msglist").prepend(interText(ret));
						echo.init({
							offset : 100,
							throttle : 250,
							callback : function(element, op) {
							}
						});
					
				}
				document.getElementById('msglist').scrollIntoView();
			});
			}
	});
			}
	
			function getdate() {
				var bodyParam = {
//					'fields' : {
//						'username' : true,
//						'id' : true,
//						'userimg' : true,
//						'imToken' : true,
//					},
					order : 'createdAt DESC',
					skip:skip,
					limit:limit
					
				};
				$api.ajax('/fabu?filter=' + JSON.stringify(bodyParam), 'get', null, function(ret, err) {
					if (ret) {
						//							alert(JSON.stringify(ret[0]));
						//							alert(JSON.stringify(ret[0].tupian));
						var interText = doT.template($("#msglistTpl").text());
						$("#msglist").prepend(interText(ret));
						echo.init({
							offset : 100,
							throttle : 250,
							callback : function(element, op) {
							}
						});
						api.parseTapmode();
						skip=skip+5;
							if(ret.length>0){
						api.toast({
								msg : '有'+ret.length+'条最新内容',
								duration : 1000,
								location : 'top'
							});
							}else{
							
							api.toast({
								msg : '没有最新消息了，稍后再刷新试试吧',
								duration : 1000,
								location : 'top'
							});
							}
					}
				})
			}
		</script>
	
</html>